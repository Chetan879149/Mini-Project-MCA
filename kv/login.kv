<LoginSignupScreen>:
    FloatLayout:
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Rectangle:
                pos: self.pos
                size: self.size

        BoxLayout:
            id: card_box
            orientation: 'vertical'
            size_hint: None, None
            width: min(380, root.width * 0.93)
            height: min(650, root.height * 0.93)  # Increased height to accommodate new screen
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            padding: 24
            spacing: 16

            Image:
                source: "assets/logo2.png"
                size_hint_y: None
                height: "84dp"
                allow_stretch: True
                pos_hint: {"center_x": 0.5}
                opacity: 1

            Widget:
                size_hint_y: None
                height: 10

            ScreenManager:
                id: login_views
                size_hint_y: 1

                # ----- Login View -----
                Screen:
                    name: "login_view"
                    ScrollView:
                        do_scroll_x: False
                        do_scroll_y: True
                        BoxLayout:
                            orientation: 'vertical'
                            size_hint_y: None
                            height: self.minimum_height
                            spacing: 12
                            padding: [0, 0]

                            TextInput:
                                id: adhar_input
                                hint_text: "Aadhar No."
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_active: ""
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                font_size: 16
                                multiline: False
                                padding: [15, (self.height - self.line_height) / 2]

                            TextInput:
                                id: password_input
                                hint_text: "Password"
                                password: True
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_active: ""
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                font_size: 16
                                multiline: False
                                padding: [15, (self.height - self.line_height) / 2]

                            Spinner:
                                id: role_spinner
                                text: "Select Role"
                                values: ["Admin", "Doctor", "Patient"]
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_color: 0.2, 0.6, 0.4, 1
                                color: 1, 1, 1, 1
                                font_size: 16

                            Button:
                                text: "Log In"
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_color: 0.2, 0.6, 0.4, 1
                                color: 1, 1, 1, 1
                                font_size: 16
                                bold: True
                                on_release: root.validate_login()

                            BoxLayout:
                                size_hint_y: None
                                height: 34
                                spacing: 16

                                Button:
                                    text: "Forgot password?"
                                    background_normal: ""
                                    background_color: 0, 0, 0, 0
                                    color: 0.18, 0.34, 0.82, 1
                                    font_size: 14
                                    on_release: root.screen_switch("forgot_view")

                                Button:
                                    text: "Sign Up"
                                    background_normal: ""
                                    background_color: 0, 0, 0, 0
                                    color: 0.18, 0.34, 0.82, 1
                                    font_size: 14
                                    on_release: root.screen_switch("signup_view")

                # ----- Signup View -----
                Screen:
                    name: "signup_view"
                    ScrollView:
                        do_scroll_x: False
                        do_scroll_y: True
                        BoxLayout:
                            orientation: 'vertical'
                            size_hint_y: None
                            height: self.minimum_height
                            spacing: 12
                            padding: [0, 0]

                            TextInput:
                                id: name_input
                                hint_text: "Name"
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_active: ""
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                font_size: 16
                                multiline: False
                                padding: [15, (self.height - self.line_height) / 2]

                            TextInput:
                                id: email_input
                                hint_text: "Email"
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_active: ""
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                font_size: 16
                                multiline: False
                                padding: [15, (self.height - self.line_height) / 2]

                            TextInput:
                                id: signup_adhar_input
                                hint_text: "Aadhar No."
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_active: ""
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                font_size: 16
                                multiline: False
                                padding: [15, (self.height - self.line_height) / 2]

                            TextInput:
                                id: phone_input
                                hint_text: "Phone number"
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_active: ""
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                font_size: 16
                                multiline: False
                                padding: [15, (self.height - self.line_height) / 2]

                            TextInput:
                                id: signup_password_input
                                hint_text: "Password"
                                password: True
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_active: ""
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                font_size: 16
                                multiline: False
                                padding: [15, (self.height - self.line_height) / 2]

                            Spinner:
                                id: signup_role_spinner
                                text: "Signin as"
                                values: ["Patient", "Doctor"]
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_color: 0.2, 0.6, 0.4, 1
                                color: 1, 1, 1, 1
                                font_size: 16

                            Button:
                                text: "Sign Up"
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_color: 0.2, 0.6, 0.4, 1
                                color: 1, 1, 1, 1
                                font_size: 16
                                bold: True
                                on_release: root.validate_signup()

                            Button:
                                text: "← Back"
                                size_hint_y: None
                                height: 32
                                background_normal: ""
                                background_color: 0, 0, 0, 0
                                color: 0.18, 0.34, 0.82, 1
                                font_size: 14
                                on_release: root.screen_switch("login_view")

                # ----- Forgot Password View -----
                Screen:
                    name: "forgot_view"
                    ScrollView:
                        do_scroll_x: False
                        do_scroll_y: True
                        BoxLayout:
                            orientation: "vertical"
                            size_hint_y: None
                            height: self.minimum_height
                            spacing: 12
                            padding: [0, 0]

                            TextInput:
                                id: forgot_adhar_input
                                hint_text: "Enter Aadhar"
                                size_hint_y: None
                                height: 34
                                background_normal: ""
                                background_active: ""
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                font_size: 16
                                multiline: False
                                padding: [15, (self.height - self.line_height) / 2]

                            Button:
                                text: "Get OTP"
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_color: 0.2, 0.6, 0.4, 1
                                color: 1, 1, 1, 1
                                font_size: 16
                                bold: True
                                on_release: root.send_otp()

                            Label:
                                id: otp_notice
                                size_hint_y: None
                                height: 20
                                color: 0.6, 0.2, 0.05, 1
                                font_size: 13

                            BoxLayout:
                                orientation: "horizontal"
                                spacing: 8
                                size_hint_y: None
                                height: 44

                                TextInput:
                                    id: otp1
                                    input_filter: "int"
                                    multiline: False
                                    halign: "center"
                                    font_size: 18
                                    size_hint_x: 0.22
                                    background_normal: ""
                                    background_active: ""
                                    background_color: 0.96, 0.96, 0.96, 1
                                    foreground_color: 0, 0, 0, 1
                                    on_text: root.on_otp_text(self, self.text)

                                TextInput:
                                    id: otp2
                                    input_filter: "int"
                                    multiline: False
                                    halign: "center"
                                    font_size: 18
                                    size_hint_x: 0.22
                                    background_normal: ""
                                    background_active: ""
                                    background_color: 0.96, 0.96, 0.96, 1
                                    foreground_color: 0, 0, 0, 1
                                    on_text: root.on_otp_text(self, self.text)

                                TextInput:
                                    id: otp3
                                    input_filter: "int"
                                    multiline: False
                                    halign: "center"
                                    font_size: 18
                                    size_hint_x: 0.22
                                    background_normal: ""
                                    background_active: ""
                                    background_color: 0.96, 0.96, 0.96, 1
                                    foreground_color: 0, 0, 0, 1
                                    on_text: root.on_otp_text(self, self.text)

                                TextInput:
                                    id: otp4
                                    input_filter: "int"
                                    multiline: False
                                    halign: "center"
                                    font_size: 18
                                    size_hint_x: 0.22
                                    background_normal: ""
                                    background_active: ""
                                    background_color: 0.96, 0.96, 0.96, 1
                                    foreground_color: 0, 0, 0, 1
                                    on_text: root.on_otp_text(self, self.text)

                            Button:
                                text: "Confirm"
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_color: 0.12, 0.29, 0.61, 1
                                color: 1, 1, 1, 1
                                font_size: 16
                                bold: True
                                on_release: root.verify_otp()

                            Button:
                                text: "← Back"
                                size_hint_y: None
                                height: 32
                                background_normal: ""
                                background_color: 0, 0, 0, 0
                                color: 0.18, 0.34, 0.82, 1
                                font_size: 14
                                on_release: root.screen_switch("login_view")

                # ----- Reset Password View -----
                Screen:
                    name: "reset_password_view"
                    ScrollView:
                        do_scroll_x: False
                        do_scroll_y: True
                        BoxLayout:
                            orientation: "vertical"
                            size_hint_y: None
                            height: self.minimum_height
                            spacing: 12
                            padding: [24, 24]

                            Label:
                                text: "Reset Password"
                                font_size: 22
                                size_hint_y: None
                                height: 40
                                bold: True

                            TextInput:
                                id: new_password_input
                                hint_text: "New Password"
                                password: True
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_active: ""
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                font_size: 16
                                padding: [15, (self.height - self.line_height) / 2]

                            TextInput:
                                id: confirm_password_input
                                hint_text: "Confirm Password"
                                password: True
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_active: ""
                                background_color: 0.96, 0.96, 0.96, 1
                                foreground_color: 0, 0, 0, 1
                                font_size: 16
                                padding: [15, (self.height - self.line_height) / 2]

                            Button:
                                text: "Reset Password"
                                size_hint_y: None
                                height: 44
                                background_normal: ""
                                background_color: 0.2, 0.6, 0.4, 1
                                color: 1, 1, 1, 1
                                font_size: 16
                                bold: True
                                on_release: root.reset_password()

                            Button:
                                text: "← Back to Login"
                                size_hint_y: None
                                height: 32
                                background_normal: ""
                                background_color: 0, 0, 0, 0
                                color: 0.18, 0.34, 0.82, 1
                                font_size: 14
                                on_release: root.screen_switch("login_view")
