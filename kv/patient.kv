#:import get_color_from_hex kivy.utils.get_color_from_hex
#:import Graph kivy_garden.graph.Graph

# --- Custom Styles ---

<Label>:
    # Default style for all labels to ensure they are black (readable on white)
    color: get_color_from_hex("#000000")

<BoldLabel@Label>:
    bold: True

# --- Custom Widget: VitalBox ---
<VitalBox>:
    orientation: 'vertical'
    padding: dp(10)
    canvas.before:
        Color:
            rgba: root.box_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10)]
    
    Label:
        text: root.title
        font_size: '18sp'
        bold: True
        color: 1, 1, 1, 1  # White text
        size_hint_y: 0.3
    
    Label:
        text: root.value
        font_size: '28sp'
        bold: True
        color: 1, 1, 1, 1  # White text
        size_hint_y: 0.5

    Label:
        text: root.unit
        font_size: '14sp'
        color: 1, 1, 1, 1  # White text
        size_hint_y: 0.2

# --- Main Dashboard Layout ---
<PatientDashboard>:
    orientation: 'vertical'
    padding: dp(15)
    spacing: dp(10)
    
    # White Background
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size

    # 1. Title
    BoldLabel:
        text: 'Patient Dashboard'
        font_size: '32sp'
        size_hint_y: 0.08
        text_size: self.size
        halign: 'left'
        valign: 'middle'

    # 2. Patient Info Grid
    GridLayout:
        cols: 4
        size_hint_y: 0.12
        spacing: dp(10)
        
        # Row 1
        BoldLabel:
            text: 'Patient Name:'
            halign: 'right'
        Label:
            text: 'Chetan '
            halign: 'left'
        BoldLabel:
            text: 'Room:101'
            halign: 'right'
        Label:
            text: '305B'
            halign: 'left'

        # Row 2
        BoldLabel:
            text: 'Age:'
            halign: 'right'
        Label:
            text: '25'
            halign: 'left'
        BoldLabel:
            text: 'Condition:'
            halign: 'right'
        Label:
            text: 'Stable (Post-Op)'
            halign: 'left'

                

    # 3. Vitals Section Title
    BoldLabel:
        text: 'Current Vitals'
        font_size: '24sp'
        size_hint_y: 0.08
        text_size: self.size
        halign: 'left'
        valign: 'bottom'

    # 4. Vitals Grid (The Colored Boxes)
    GridLayout:
        cols: 2
        spacing: dp(15)
        size_hint_y: 0.25
        
        VitalBox:
            title: 'Heart Rate'
            value: '78'
            unit: 'bpm'
            box_color: get_color_from_hex("#E74C3C") # Red

        VitalBox:
            title: 'Blood Pressure'
            value: '122/81'
            unit: 'mmHg'
            box_color: get_color_from_hex("#3498DB") # Blue

        VitalBox:
            title: 'SpO2'
            value: '97'
            unit: '%'
            box_color: get_color_from_hex("#2ECC71") # Green

        VitalBox:
            title: 'Temperature'
            value: '98.4'
            unit: 'Â°F'
            box_color: get_color_from_hex("#F39C12") # Orange

    # 5. Graph Section Title
    BoldLabel:
        text: 'Vitals Trend (Last 12 Hours)'
        font_size: '24sp'
        size_hint_y: 0.08
        text_size: self.size
        halign: 'left'
        valign: 'bottom'

    # 6. Graph Container
    AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'center'
        size_hint_y: 0.35
        
        Graph:
            # --- THIS IS THE CORRECT PLACE FOR THE ID ---
            id: vitals_graph 
            xlabel: 'Hour'
            ylabel: 'Value'
            x_ticks_minor: 1
            x_ticks_major: 2
            y_ticks_major: 20
            y_grid_label: True
            x_grid_label: True
            padding: dp(5)
            x_grid: True
            y_grid: True
            xmin: 0
            xmax: 11
            ymin: 60
            ymax: 140
            # Graph Styling
            label_options: {'color': get_color_from_hex("#000000"), 'bold': True}
            background_color: 1, 1, 1, 1
            tick_color: get_color_from_hex("#888888")
            border_color: get_color_from_hex("#888888")

    # 7. Legend
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: 0.05
        spacing: dp(20)
        padding: [dp(50), 0]
        
        # --- Item 1: Heart Rate ---
        BoxLayout:
            orientation: 'horizontal'
            spacing: dp(5)
            size_hint_x: None
            width: dp(160)
            
            # Draw a Red Circle
            Widget:
                size_hint: None, None
                size: dp(16), dp(16)
                pos_hint: {'center_y': 0.5}
                canvas:
                    Color:
                        rgba: get_color_from_hex("#E74C3C")
                    Ellipse:
                        pos: self.pos
                        size: self.size
            
            # --- FIXED SECTION BELOW ---
            Label:
                text: 'Heart Rate (bpm)'
                size_hint_y: 0.5
                font_size: '16sp'
                color: get_color_from_hex("#000000")
                halign: 'left'
                valign: 'middle'
                text_size: self.size

        # --- Item 2: Blood Pressure ---
        BoxLayout:
            orientation: 'horizontal'
            spacing: dp(5)
            size_hint_x: None
            width: dp(180)
            
            # Draw a Blue Circle
            Widget:
                size_hint: None, None
                size: dp(16), dp(16)
                pos_hint: {'center_y': 0.5}
                canvas:
                    Color:
                        rgba: get_color_from_hex("#3498DB")
                    Ellipse:
                        pos: self.pos
                        size: self.size
            
            Label:
                text: 'BP Systolic (mmHg)'
                font_size: '16sp'
                color: get_color_from_hex("#000000")
                halign: 'left'
                valign: 'middle'
                text_size: self.size